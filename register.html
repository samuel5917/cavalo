<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logistics Input | Registro de Remanejo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://lucide.dev/icons/lucide.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass { background: #0f172a; border: 1px solid #1e293b; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        input, select { background: #1e293b !important; border: 1px solid #334155 !important; color: white !important; transition: all 0.2s; }
        input:focus, select:focus { border-color: #3b82f6 !important; ring: 2px solid rgba(59, 130, 246, 0.1); outline: none; }
        .btn-gradient { background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); transition: all 0.3s; }
        .btn-gradient:hover { filter: brightness(1.1); transform: translateY(-1px); }
        .btn-gradient:active { transform: translateY(0); }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-2xl glass rounded-3xl overflow-hidden">
        <div class="bg-slate-900/80 px-6 py-3 border-b border-slate-800 flex justify-between items-center">
            <div class="flex gap-1.5">
                <div class="w-3 h-3 rounded-full bg-red-500/20 border border-red-500/40"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500/20 border border-yellow-500/40"></div>
                <div class="w-3 h-3 rounded-full bg-emerald-500/20 border border-emerald-500/40"></div>
            </div>
            <span class="text-[10px] font-mono text-slate-500 tracking-[0.3em]">INPUT_MODE: ACTIVE</span>
        </div>

        <div class="p-8 md:p-12">
            <header class="mb-10">
                <h1 class="text-3xl font-bold tracking-tighter flex items-center gap-3">
                    <i data-lucide="arrow-right-left" class="text-blue-500"></i> REMANEJO PRO
                </h1>
                <p class="text-slate-400 mt-2 text-sm">Preencha os campos abaixo para registrar a movimentação no banco de dados.</p>
            </header>

            <form id="formRegistro" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">Tag CB</label>
                        <input type="text" id="tag_cb" required placeholder="Ex: CB-1020" class="w-full p-4 rounded-2xl text-sm font-mono">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">Material</label>
                        <input type="text" id="material" required placeholder="Tipo de Material" class="w-full p-4 rounded-2xl text-sm">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">Origem</label>
                        <input type="text" id="origem" required placeholder="Local de Saída" class="w-full p-4 rounded-2xl text-sm">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">Destino</label>
                        <input type="text" id="destino" required placeholder="Local de Chegada" class="w-full p-4 rounded-2xl text-sm">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1 text-blue-400">Peso Bruto (kg)</label>
                        <input type="number" step="0.001" id="peso" required placeholder="0.000" class="w-full p-4 rounded-2xl text-sm font-bold text-blue-400">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold text-slate-500 uppercase tracking-widest ml-1">Turno de Trabalho</label>
                        <select id="turno" class="w-full p-4 rounded-2xl text-sm cursor-pointer appearance-none">
                            <option>1º Turno</option>
                            <option>2º Turno</option>
                            <option>3º Turno</option>
                        </select>
                    </div>
                </div>

                <div class="pt-4">
                    <button type="submit" id="btnSubmit" class="btn-gradient w-full py-5 rounded-2xl text-white font-bold text-sm uppercase tracking-[0.2em] flex items-center justify-center gap-3 shadow-2xl shadow-blue-600/20">
                        <i data-lucide="upload-cloud" size="20"></i> Confirmar e Salvar
                    </button>
                </div>
            </form>
        </div>

        <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 px-6 py-3 rounded-full bg-emerald-600 text-white font-bold text-sm shadow-2xl transition-all opacity-0 translate-y-10">
            REGISTRO SALVO COM SUCESSO!
        </div>
    </div>

    <script>
        lucide.createIcons();

        // Suas Credenciais do Supabase
        const SUPABASE_URL = 'https://lkbyphypfmouahxpzhst.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_N9X2k--CcuTcdNFUDU0K8w_wEKZaJvV';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const form = document.getElementById('formRegistro');
        const btn = document.getElementById('btnSubmit');
        const toast = document.getElementById('toast');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Estado de carregamento visual
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin"></i> ENVIANDO PARA O BANCO...`;
            lucide.createIcons();

            // Captura de dados e timestamps automáticos
            const payload = {
                tag_cb: document.getElementById('tag_cb').value,
                material: document.getElementById('material').value,
                origem: document.getElementById('origem').value,
                destino: document.getElementById('destino').value,
                peso: parseFloat(document.getElementById('peso').value),
                turno: document.getElementById('turno').value,
                data: new Date().toLocaleDateString('pt-BR'),
                horario: new Date().toLocaleTimeString('pt-BR')
            };

            const { error } = await _supabase
                .from('movimentacoes')
                .insert([payload]);

            if (error) {
                alert("Erro ao salvar: " + error.message);
                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="alert-circle"></i> TENTAR NOVAMENTE`;
            } else {
                // Sucesso
                showToast();
                form.reset();
                btn.innerHTML = `<i data-lucide="check-circle"></i> SUCESSO!`;
                
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = `<i data-lucide="upload-cloud" size="20"></i> Confirmar e Salvar`;
                    lucide.createIcons();
                }, 2000);
            }
        });

        function showToast() {
            toast.classList.remove('opacity-0', 'translate-y-10');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }
    </script>
</body>
</html>
